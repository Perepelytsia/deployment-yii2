version: '3.3'
services:
    nginx1.18:
        image: nginx:1.18
        restart: unless-stopped
        ports:
            - "${NGINX_PORT}:80"
        volumes:
            - ./etc/nginx:/etc/nginx/conf.d
            - ./backend:/var/www
            - ./logs/nginx:/var/log/nginx
        environment:
            - NGINX_HOST=foobar.localhost
        command: /bin/bash -c "envsubst < /etc/nginx/conf.d/mysite.template > /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;'" 
        links:
            - php7.1
    php7.1:
        build: ./images/php
        image: php:7.1
        restart: unless-stopped
        volumes:
            - ./etc/php /usr/local/etc/php/conf.d/40-custom.ini
            - ./backend:/var/www
            - ./logs/php:/var/log/php
        links:
            - mysql5.7
            - redis5.0
    composer1.10:
        image: composer:1.10
        command: ["composer", "install"]
        volumes:
            - ./backend:/app
    mysql5.7:
        image: mysql:5.7
        restart: unless-stopped
        environment:
            - MYSQL_DATABASE=docker2
            - MYSQL_ROOT_PASSWORD=admin
            - MYSQL_USER=docker2
            - MYSQL_PASSWORD=docker2
        volumes:
            - ./etc/mysql/my.cnf:/etc/mysql/conf.d/my.cnf
            - ./store/mysql:/var/lib/mysql
            - ./logs/mysql:/var/log/mysql/general-log.log
    redis5.0:
        image: redis:5.0
        volumes:
            - ./store/redis:/var/lib/redis
            - ./etc/redis/redis.conf:/usr/local/etc/redis/redis.conf
            - ./logs/redis:/var/log/redis

